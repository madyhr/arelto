# Arelto

[Arelto Trailer](https://github.com/user-attachments/assets/5101cb45-c6c6-4dc1-a29d-d21d82417f72)
<!--toc:start-->
- [Arelto](#arelto)
  - [Prerequisites](#prerequisites)
    - [Python](#python)
    - [Linux](#linux)
      - [Debian/Ubuntu](#debianubuntu)
      - [Arch](#arch)
    - [Windows](#windows)
      - [1. Install [Conda](https://www.anaconda.com/download) or [Miniconda](https://docs.conda.io/en/latest/miniconda.html)](#1-install-condahttpswwwanacondacomdownload-or-minicondahttpsdocscondaioenlatestminicondahtml)
      - [2. Create a Conda Environment](#2-create-a-conda-environment)
      - [3. Install Dependencies via Conda](#3-install-dependencies-via-conda)
      - [4. Install [vcpkg](https://vcpkg.io/en/getting-started.html)](#4-install-vcpkghttpsvcpkgioengetting-startedhtml)
      - [5. Install C++ Dependencies](#5-install-c-dependencies)
  - [Installation](#installation)
  - [Running the Game](#running-the-game)
  - [How to play](#how-to-play)
  - [Development](#development)
    - [Building](#building)
    - [Tests](#tests)
      - [Python tests](#python-tests)
      - [C++ tests](#c-tests)
  - [Generative AI Disclaimer](#generative-ai-disclaimer)
<!--toc:end-->

A Reinforcement Learning Rogue-Lite (RL2) game where the enemies get smarter over time. Try to survive for as long as you can!

## Prerequisites

Before installing, ensure you have the following system dependencies installed and that you are using an [NVIDIA GPU](https://developer.nvidia.com/cuda/gpus)[^1].

### Python

- Python 3.10 or higher.

### Linux

#### Debian/Ubuntu

```bash
sudo apt update
sudo apt install cmake build-essential python3-dev
sudo apt install libsdl2-dev libsdl2-image-dev libsdl2-ttf-dev libsdl2-mixer
sudo apt install libomp-dev
```

#### Arch

```bash
sudo pacman -S cmake base-devel python sdl2 sdl2_image sdl2_ttf sdl2_mixer
```

### Windows

#### 1. Install [Conda](https://www.anaconda.com/download) or [Miniconda](https://docs.conda.io/en/latest/miniconda.html)

#### 2. Create a Conda Environment

```bash
conda create -n arelto-env python=3.10
conda activate arelto-env
```

#### 3. Install Dependencies via Conda

```bash
conda install -y cmake ninja numpy pytorch -c pytorch -c conda-forge
```

#### 4. Install [vcpkg](https://vcpkg.io/en/getting-started.html)

```bash
git clone https://github.com/microsoft/vcpkg.git
.\vcpkg\bootstrap-vcpkg.bat
```

#### 5. Install C++ Dependencies

```bash
.\vcpkg\vcpkg install sdl2 sdl2-image sdl2-ttf sdl2-mixer --triplet x64-windows
```

> [!NOTE]
> Ensure that `vcpkg` is accessible in your path or note down its installation location for the build step.

> [!WARNING]
> macOS is not supported.

## Installation

1. **Clone the repository:**

    ```bash
    git clone https://github.com/madyhr/arelto.git
    cd arelto
    ```

2. **Fetch external dependencies:**

    ```bash
    git submodule update --init --recursive
    ```

3. **Create a virtual environment (Recommended):**

    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

4. **Install the game as a package:**

    **Linux:**

    ```bash
    pip install -e .
    ```

    **Windows:**

    You need to specify the `vcpkg` toolchain file. Adjust the path to where you installed `vcpkg`.

    ```bash
    # CMD / PowerShell
    $env:CMAKE_TOOLCHAIN_FILE="C:/path/to/vcpkg/scripts/buildsystems/vcpkg.cmake"
    $env:VCPKG_TARGET_TRIPLET="x64-windows"
    pip install -e .
    ```

    *Note: This process may take some time as it downloads all dependencies and compiles the C++ backend.*

## Running the Game

To start the game with the asynchronous agent (default experience):

```bash
python scripts/start_game_async.py
```

Alternatively, there is also a synchronous agent variant. However, the game pauses during policy updates, so it is also not as smooth an experience.

```bash
python scripts/start_game.py
```

## How to play

For information on how to play the game please check out the [wiki](https://github.com/madyhr/arelto/wiki).

## Development

### Building

For development, it is recommended that you use `cmake` instead of `pip`:

```bash
cmake -B build -G Ninja -DCMAKE_INSTALL_PREFIX=.
```

```bash
ninja -C build install
```

In the case that you have already installed `arelto` as a package in your virtual environment, you may want to explicitly set the `PYTHONPATH`.

```bash
# If you are in path/to/arelto/:
export PYTHONPATH=$PWD
```

### Tests

- **Running Tests:**

  #### Python tests

    ```bash
    python -m pytest tests
    ```

  #### C++ tests

    ```bash
    ./build/arelto_tests
    ```

> [!NOTE]
> The C++ tests require you build using `cmake` as described in the Development section.

## Generative AI Disclaimer

All the digital assets used in this project have been generated by [Nano Banana Pro](https://deepmind.google/models/gemini-image/pro/) and [Veo](https://deepmind.google/models/veo/). Some light editing was afterwards done in [Pinta](https://www.pinta-project.com/) to move around the different assets, remove backgrounds and organize them into more easily usable texture maps.

The music was generated by asking [Google Antigravity](https://antigravity.google/) to create a soundtrack "based on the vibes coming from the code" written in [Strudel.cc](https://www.strudel.cc).
- - -
[^1]: An NVIDIA GPU is required as the default experience using an asynchronous learning agent. Here the training and inference are both run on the GPU in parallel CUDA streams, while the game itself runs on the CPU. This is to create a smooth gameplay experience while also being able to train the agent in a reasonable amount of time.
